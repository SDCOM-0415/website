# 自动化部署流水线 (Workflow)

自动化部署流水线是 ALLinSSL 的核心功能之一，它允许你定义一系列步骤，自动完成 SSL 证书的申请、部署和通知等任务。

![自动化部署流水线示例](/images/workflow-edit.png)

## 流水线列表

进入"自动化部署流水线"页面，你将看到已创建的所有流水线列表。

![自动化部署流水线示例](/images/workflow.png)

## 节点编辑器与配置

流水线由一系列按顺序或条件执行的"节点"组成。你可以在可视化编辑器中拖拽、连接和配置这些节点。

### 1. 触发方式 (Trigger)

*   **说明:** 这是每个流水线的起点，通常在创建时自动添加且不可删除。
*   **配置选项:**
    *   **自动执行:** 设置一个定时计划（例如每天凌晨 1 点）来自动触发流水线。通常用于证书的自动续期和部署。
    *   **手动执行:** 流水线仅能通过手动点击"执行"按钮来触发。
*   **默认:** 通常默认为"自动执行"。

### 2. 可选节点步骤 (Steps/Nodes)

你可以从节点库中选择并添加以下类型的步骤：

*   **申请 SSL (Apply SSL):** 用于自动从 CA (如 Let's Encrypt) 申请证书。
*   **部署 SSL (Deploy SSL):** 将获取到的证书部署到指定的目标位置。
*   **通知告警 (Notify):** 在流水线执行成功或失败后发送通知。
*   **并行分支 (Parallel):** 允许同时执行多个后续步骤分支。
*   **执行结果分支 (Conditional):** 根据上一个节点的执行结果（成功/失败）来决定执行哪个后续分支。

### 3. 各节点详细配置

#### a. 申请 SSL 节点

#### b. 部署 SSL 节点

点击配置此节点时，会弹出窗口让你选择部署目标和方式。

*   **部署目标类型 (Target Type):**

    *   **本地部署 (Local Deployment):**

    *   **SSH 部署 (Remote SSH Deployment):**

    *   **宝塔面板 / 1Panel (部署到面板证书库):**

    *   **宝塔面板 / 1Panel (部署到指定网站):**

    *   **腾讯云 CDN / 阿里云 CDN:**

    *   **腾讯云 WAF:**

    *   **阿里云 WAF:**

#### c. 通知告警节点

#### d. 并行分支节点

*   点击添加后，会在当前节点下方创建两个或多个并行的分支路径。
*   每个分支可以独立添加后续节点。
*   所有并行分支执行完毕后，流水线才会继续执行后续步骤（如果有的话）。

#### e. 执行结果分支节点

*   只能添加在"申请 SSL"、"部署 SSL"或"通知告警"等可能产生明确成功/失败结果的节点之后。
*   点击添加后，会创建两个分支：
    *   **成功时 (On Success):** 当上一个节点执行成功时，执行此分支下的节点。
    *   **失败时 (On Failure):** 当上一个节点执行失败时，执行此分支下的节点。
